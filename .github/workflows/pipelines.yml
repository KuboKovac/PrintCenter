name: Cypress tests

on: [push]

jobs:
  cypress-run:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Setup dotnet
  
        uses: actions/setup-dotnet@v3
        with:
              working-directory: ./api
              dotnet-version: '6.x.x'
              start: dotnet watch run
              
      #Install NPM dependencies, cache them correctly
      #and run all cypress tests
      - name: Cypress run
        uses: cypress-io/github-action@v2.9.1
        with:
              working-directory: ./client
              run: npm i
              build: npm run build
              start: npm start
              cypress-version: '12.2.0'
              config-file: cypress.config.ts
              record: true
        env:
          CYPRESS_RECORD_KEY: ${{secrets.CYPRESS_RECORD_KEY}}
          GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}
